<view class="container">
  <!-- Top Banner / Shop Info -->
  <view class="header">
    <view class="shop-info">
      <view class="shop-name">æ ¡å†…ç¬¬ä¸€é£Ÿå ‚</view>
      <view class="shop-notice">å…¬å‘Šï¼šä»Šæ—¥æ¨å‡ºç‰¹è‰²ç›–æµ‡é¥­ï¼Œæ¬¢è¿å“å°ï¼</view>
    </view>
    <view class="header-bg"></view>
  </view>

  <view class="content-wrapper">
    <!-- Left Sidebar: Categories -->
    <scroll-view class="category-sidebar" scroll-y>
      <block wx:for="{{categories}}" wx:key="*this">
        <view class="category-item {{currentCategory === item ? 'active' : ''}}" 
              bindtap="switchCategory" data-category="{{item}}">
          <view class="cat-text">{{item}}</view>
          <view class="active-indicator" wx:if="{{currentCategory === item}}"></view>
        </view>
      </block>
    </scroll-view>

    <!-- Right Side: Dish List -->
    <scroll-view class="dish-list" scroll-y>
      <view class="section-title">{{currentCategory}}</view>
      <block wx:for="{{currentDishes}}" wx:key="id">
        <view class="dish-card">
          <image class="dish-img" src="{{item.imageUrl || '/images/default-dish.png'}}" mode="aspectFill"></image>
          <view class="dish-info">
            <view class="dish-name">{{item.name}}</view>
            <view class="dish-desc">{{item.description || 'æš‚æ— æè¿°'}}</view>
            <view class="dish-bottom">
              <view class="dish-price"><text class="currency">ï¿¥</text>{{item.price}}</view>
              <view class="dish-action">
                <view wx:if="{{cart[item.id] > 0}}" class="btn-minus" bindtap="removeFromCart" data-item="{{item}}">ï¼</view>
                <view wx:if="{{cart[item.id] > 0}}" class="count">{{cart[item.id]}}</view>
                <view class="btn-plus" bindtap="addToCart" data-item="{{item}}">ï¼‹</view>
              </view>
            </view>
          </view>
        </view>
      </block>
      <view wx:if="{{currentDishes.length === 0}}" class="empty-tip">
        <image class="empty-img" src="/images/empty.png" mode="widthFix" style="width:100px;opacity:0.3"></image>
        <view>è¯¥åˆ†ç±»ä¸‹æš‚æ— èœå“</view>
      </view>
      <view class="spacer-bottom"></view> <!-- Spacer for cart bar -->
    </scroll-view>
  </view>

  <!-- Bottom Cart Bar -->
  <view class="cart-bar-wrapper">
    <view class="cart-bar">
      <view class="cart-icon-container {{totalCount > 0 ? 'active' : ''}}" bindtap="toggleCartDetail">
        <view class="cart-icon">ğŸ›’</view>
        <view wx:if="{{totalCount > 0}}" class="badge">{{totalCount}}</view>
      </view>
      <view class="cart-info">
        <view class="total-price" wx:if="{{totalCount > 0}}">ï¿¥<text class="price-num">{{totalPrice}}</text></view>
        <view class="total-price empty" wx:else>æœªé€‰è´­å•†å“</view>
        <view class="delivery-tip">å¦éœ€é…é€è´¹ ï¿¥0</view>
      </view>
      <view class="checkout-btn {{totalCount > 0 ? '' : 'disabled'}}" bindtap="showCheckoutModal">
        {{totalCount > 0 ? 'å»ç»“ç®—' : 'ï¿¥0 èµ·é€'}}
      </view>
    </view>
  </view>

  <!-- Checkout Modal -->
  <view wx:if="{{showCheckout}}" class="modal-mask">
    <view class="modal-content">
      <view class="modal-header">
        <text>ç¡®è®¤è®¢å•</text>
        <view class="close-btn" bindtap="hideCheckoutModal">âœ•</view>
      </view>
      
      <scroll-view scroll-y class="order-list">
        <block wx:for="{{cartItems}}" wx:key="id">
          <view class="cart-item-row">
            <view class="row-name">{{item.name}}</view>
            <view class="row-qty">x{{item.count}}</view>
            <view class="row-price">ï¿¥{{item.price * item.count}}</view>
          </view>
        </block>
      </scroll-view>
      
      <view class="divider"></view>
      <view class="total-row">
        <text>åˆè®¡</text>
        <text class="final-price">ï¿¥{{totalPrice}}</text>
      </view>
      
      <view class="form-area">
        <view class="form-group">
          <label>å§“å</label>
          <input class="input" placeholder="è¯·å¡«å†™è®¢é¤äººå§“å" value="{{name}}" bindinput="onInputName" />
        </view>
        <view class="form-group">
          <label>ç”µè¯</label>
          <input class="input" placeholder="è¯·å¡«å†™è”ç³»ç”µè¯" value="{{phone}}" bindinput="onInputPhone" type="number"/>
        </view>
        <view class="form-group">
          <label>å–é¤æ—¶é—´</label>
          <picker mode="time" value="{{diningTime}}" start="07:00" end="20:00" bindchange="onTimeChange">
            <view class="picker input {{diningTime ? '' : 'placeholder'}}">{{diningTime || 'é€‰æ‹©æ—¶é—´'}}</view>
          </picker>
        </view>
        <view class="form-group">
          <label>å¤‡æ³¨</label>
          <input class="input" placeholder="å£å‘³åå¥½ç­‰ (é€‰å¡«)" value="{{remark}}" bindinput="onInputRemark" />
        </view>
      </view>

      <view class="modal-footer">
        <button class="btn-confirm-order" bindtap="submitOrder">ç«‹å³æ”¯ä»˜</button>
      </view>
    </view>
  </view>

</view>
